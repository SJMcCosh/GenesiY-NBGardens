<ui:composition xmlns="https://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	template="templates/template.xhtml">
	<meta charset="ISO-8859-1" />
	<ui:define name="maincontent">

		<f:metadata>
			<f:event type="preRenderView" listener="#{filter.load}" />
		</f:metadata>

		<div class="row">
			<!-- Main content for the page -->


			<h:form class="col-3 col-m-6 tagbar">
				<div class="tagbar">
					<p>
						<b>Tags</b>
					</p>
					<h:selectManyCheckbox layout="pageDirection"
						value="#{catpage.tagNameArray}">
						<f:selectItems value="#{catpage.tagModel}" var="tag"
							itemLabel="#{tag.name}" itemValue="#{tag.name}" />
						<f:ajax listener="#{filter.filterProductsByTag}" render="@all" />
					</h:selectManyCheckbox>

					<p>
						<b>Filter by Price</b>
					</p>

						<h:outputText value = "Minimum Price: "/><h:inputText value = "#{filter.minimum}" style = "width: 30px"/>
						<br />
						<h:outputText value = " Maximum Price: "/><h:inputText value = "#{filter.maximum}" style = "width: 30px"/>
						<f:ajax event = "keyup" listener="#{filter.filterByPrice}" render="@all"/>
						
					<p>
						<b>Filter by Rating</b>
					</p>

						<h:outputText value = "Minimum Rating: "/><h:inputText value = "#{filter.minrat}" style = "width: 30px"/>
						<br />
						<h:outputText value = " Maximum Rating: "/><h:inputText value = "#{filter.maxrat}" style = "width: 30px"/>
						<f:ajax event = "keyup" listener="#{filter.filterByRating}" render="@all"/>

				</div>
			</h:form>



			<h:form>
				<div class="col-9 col-m-6">
					<h:selectOneMenu value="#{sort.sorter}">
						<f:selectItem itemLabel="Rating" itemValue="Rating" />
						<f:selectItem itemLabel="Price Low to High"
							itemValue="Price Low to High" />
						<f:selectItem itemLabel="Price High to Low"
							itemValue="Price High to Low" />
						<f:ajax listener="#{sort.sort}" render="@this prodliststuff" />
					</h:selectOneMenu>
				</div>


			</h:form>

			<!-- Pagination bit -->



			<h:form>
				<h:outputText escape="false" value="No Products Found"
					rendered="#{catpage.dataModel.rowCount == 0}" />
				<h:panelGroup rendered="#{catpage.dataModel.rowCount > 0}">
					<h:outputText
						value="Displaying products #{catpage.pagination.pageFirstItem + 1} to #{catpage.pagination.pageLastItem + 1} of #{catpage.pagination.itemsCount}" />
					<h:commandButton value="Previous #{catpage.pagination.pageSize}"
						action="#{catpage.previous}"
						rendered="#{catpage.pagination.hasPreviousPage}" />
					<h:commandButton value="Next #{catpage.pagination.pageSize}"
						action="#{catpage.next}"
						rendered="#{catpage.pagination.hasNextPage}" />
				</h:panelGroup>
			</h:form>


			<!-- This is the product grid -->

			<!-- This is the product grid -->
			<h:form id = "prodliststuff">

				<div class="col-9 col-m-6" >
					<ul>
						<ui:repeat var="product" value="#{catpage.dataModel}">
							<h:panelGroup rendered="#{product.toRender}">
								<h:commandLink action="#{catpage.viewProduct(product)}"
									class="col-3 col-m-6">


							

									<div class="listofproducts">
									
									<div class="index_featured_products_product">
								<h:commandLink action="#{products.viewProduct(product)}">
									<img class="index_featured_products_product_image" src="#{product.imageLocation}" />
									<div class="index_featured_products_product_title">
										<h:outputText value="#{product.name}" />
									</div>
							</h:commandLink>
								<p>
									<h:outputText value="#{product.averageRating}" class="index_featured_products_product_price" >
										<f:convertNumber type="currency" currencyCode="GBP" />
									</h:outputText>								
								</p>
								<img src="#{products.averageRatingImg(product.averageRating)}" />
							
							</div>
							
							<div id="featured_items_padding"></div>
							
							</div>

								</h:commandLink>
							</h:panelGroup>
							
						</ui:repeat>

					</ul>

				</div>

			</h:form>
			<div class="paginatorbutton">
				<h:form>
					<h:outputText escape="false" value="No Products Found"
						rendered="#{catpage.dataModel.rowCount == 0}" />
					<h:panelGroup rendered="#{catpage.dataModel.rowCount > 0}">
						<h:outputText
							value="Displaying products #{catpage.pagination.pageFirstItem + 1} to #{catpage.pagination.pageLastItem + 1} of #{catpage.pagination.itemsCount}" />
						<h:commandButton value="Previous #{catpage.pagination.pageSize}"
							action="#{catpage.previous}"
							rendered="#{catpage.pagination.hasPreviousPage}" />
						<h:commandButton value="Next #{catpage.pagination.pageSize}"
							action="#{catpage.next}"
							rendered="#{catpage.pagination.hasNextPage}" />
					</h:panelGroup>
				</h:form>
			</div>
		</div>
	</ui:define>
</ui:composition>